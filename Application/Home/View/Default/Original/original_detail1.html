<!-- 头部部分 -->
<include file="layout/header" />
<!-- 上中下部分 -->
<include file="layout/szx_layout" />
<style type="text/css">
        #share a{
            background: none;
        }
        *{
            margin: 0;
            padding: 0;
        }
        #share a{
            display: inline-block;
            width: 36px;
            height: 36px;
            background-color: #dddfde;
            border-radius: 50%;
            text-align: center;
            line-height: 36px;
            color: #fff;
            margin-right: 8px;
            padding: 0;
            margin-left: 0;
        }
        #share a:hover{
            text-decoration:none;
            background-color:#777;
        }
         .bsTop{
            width:208px !important;
        }
        .bsFrameDiv div{
            width:208px !important;
            height:208px !important;
        }
        #cname{
            max-height: 160px;
            border: 1px solid #cbcbcb;
            display: none;
            overflow-wrap: normal;
            padding: 0;
            margin-top: 20px;
        }
        .con{
            display: none;
            padding: 0;
        }
        .con2{
            display: block;
            padding: 0;
            padding-left: 8px;
            position: relative;
        }
        .selDown{
            position: absolute;
            right: 2px;
            top: 56px;
            width: 28px;
            height: 34px;
            display: none;
            background: url("__PUBLIC__/Home/images/down.jpg") right no-repeat;
            cursor: pointer;
        }
        p.opt{
            height: 32px;
            line-height: 32px;
            padding-left: 8px;
        }
        p.opt:hover{
            background-color: #fab708;
        }
        .showGroup{
                position: relative;
                margin-bottom: 34px;
        }
        .showGroup .gm-txt{
                width: 60px;
        }
        .showGroup .pho-list{
                position: absolute;
                top: 1px;
                left: 64px;
                font-size: 14px;
                font-family: 苹方;
        }
        .showMember{
                margin-bottom: 26px;
        }
        .showMember .pho-list li{
                margin-bottom: 14px;
        }
</style> 
<?php 
    if(session('user.uid')) {
        $is_login = 1;
    }else{
        $is_login = 0;
    }
?>
<!--中部内容-->
<div class="wrap">
    <!--左边内容列表-->
    <div class="lf-content">
                <ul class="o-img_box">
                            <foreach name="or_details[0]['cnt']" item="obj">
                                        <li><?php echo html_entity_decode($obj); ?></li>
                            </foreach>
                </ul>
                <div class="clearfix orgin_footer_fx" id="share">
                            <div class="footer_icon bg-cor-de fr bshare-custom">
                                <a title="分享到QQ" class="iconfont icon-qq bshare-qqim" href="javascript:void(0);"></a>
                                <a title="分享到微信" class="iconfont icon-weixin bshare-weixin" href="javascript:void(0);"></a>
                                <a title="分享到新浪微博" class="iconfont icon-weibo bshare-sinaminiblog" href="javascript:void(0);"></a>
                            </div>
                </div>

                <div class="thumbs">
                    <a class="thumbsIcon" id="js_thumbsIcon" aid="{$or_details[0]['id']}" href="javascript:;">
                        <img class="tb_gif" src="__IMG__/img/zy01.gif">
                    </a>
                    <?php if($or_details[0]['is_praise'] == 0){ ?>
                        <div class="thumbs_tex" pstate="0"><span>可赞</span></div>
                    <?php }else{ ?>
                        <div class="thumbs_tex" pstate="1"><span>已赞</span></div>
                    <?php } ?>
                    <div class="thumbs_num" id="js_thumbs_num">{$or_details[0]['praise_nums']}</div> 
                </div>
                <div class="c-more collection" style="width: 100%;max-width: none"><eq name="collectioned" value="0"><a href="javascript:;" type="0" id="js_collectionBtn">COLLECTION</a><else/><a href="javascript:;" type="1" id="js_collectionBtn">CANCEL</a></eq></div>
                
               <!-- 原创评论 -->
                <div id="comment_cnt" class="mga-auto01"></div>
                <div class="inspiration mgt113">
                    <i>MORE WORKS</i>
                </div>
                <div class="list_box pt70">
                    <ul class="list-ul div3 clearfix">
                          <foreach name="odata_list_more" item="obj">
                            <li sid="{$obj['id']}">
                                <a href="{:U(original_detail1)}?oid={$obj['id']}" target="_blank">
                                    <div class="img"><img src="{$obj["cover_curimg"]}"></div>
                                    <div class="c-tit">
                                        <span class="w_cname">{$obj["flf_name"]}</span>
                                        <span class="ejfl_name">{$obj["tlf_name"]}</span>
                                    </div>
                                      <div class="yc_h"><p class="c-text clamp1">{$obj["title"]}</p>
                                    <p class="text_czz">创作者：<span class="h">{$obj["nickname"]}</span></p></div>
                                </a>
                            </li>
                        </foreach>
                    </ul>
                </div>
                <p class="o-footer_copy_txt">© CO-SENSE 2016 沪ICP备14036895号-1</p>
    </div>
    <!--右边用户信息-->
    <div class="fx_infoMod">
            <div class="o-fx-dix">
                    <div class="clearfix">
                                <div class="fl p-photo">
                                        <?php if($user_type == 1){ ?>
                                            <a href="{:U('/Original/original_detail2')}?tid={$or_details[0]['uid']}">
                                                <img width="100%" height="100%" src="{$or_details[0]['avatar']}">
                                            </a>
                                        <?php }else{ ?>
                                            <a href="{:U('/Original/original_detail3')}?tid={$or_details[0]['uid']}">
                                                <img width="100%" height="100%" src="{$or_details[0]['avatar']}">
                                            </a>     
                                        <?php } ?>
                                </div>
                                <div class="fl p-text-c org">
                                        <p class="p01">
                                                        <?php if($user_type == 1){ ?>
                                                            <span ids="{$or_details[0]['uid']}" class="p-name"><a href="{:U('/Original/original_detail2')}?tid={$or_details[0]['uid']}"> 
                                                        <?php }else{ ?>
                                                            <span ids="{$or_details[0]['uid']}" class="p-name"><a href="{:U('/Original/original_detail3')}?tid={$or_details[0]['uid']}"> 
                                                        <?php } ?>
                                                        {$or_details[0]["nickname"]}</a></span>
                                                        <?php if($user_type == 1){ ?>
                                                            <?php if($or_details[0]["sex"] == 0){ ?>
                                                                <i class="sex_man iconfont icon-xingbie-nan"></i>
                                                            <?php }else{ ?>
                                                                <i class="sex_woman iconfont icon-xingbie-nv"></i>
                                                            <?php } ?>
                                                        <?php } ?>
                                        </p>
                                        <p class="p02">
                                                    <i class="icon-addr"></i>
                                                    <span class="span_text">{$or_details[0]["address"]}</span>
                                        </p>
                                        <p class="p03">
                                                    <span class="span_text" title="{$or_details[0]['industry']}"><?php echo str_replace(",","&#8197;/&#8197;",$or_details[0]["industry"]); ?></span>
                                        </p>
                                        <p class="follow_me_orgg">
                                                    <?php if($or_details[0]["is_follow"] == 0){ ?>
                                                        <a class="followBtn" type="0" ids="{$or_details[0]['uid']}" href="javascript:void(0);">FOLLOW</a>
                                                    <?php }else{ ?>
                                                        <a class="followBtn" type="1" ids="{$or_details[0]['uid']}" href="javascript:void(0);">CANCEL</a>
                                                    <?php } ?>
                                                    <i class="icon-gzr iconfont icon-fensi"></i>
                                                    <span class="t-no12-33">{$or_details[0]["fans_number"]}</span>
                                        </p>
                                </div>
                    </div>
                    <?php if($user_type == 1){ ?>
                    <div class="showGroup">
                                <div class="gm-txt">Group：</div>
                                <ul class="pho-list clearfix">
                                        <volist name="fans_info" id="fans">
                                                <li><a title="{$fans.nickname}" href="{:U('Original/original_detail3')}?tid={$fans.id}">{$fans.nickname}</a></li>
                                        </volist>
                                            
                                </ul>
                    </div>
                    <?php }else{ ?>
                    <div class="showMember">
                                <div class="gm-txt">Member：</div>
                                <ul class="pho-list clearfix">
                                           <volist name="fans_info" id="fans">
                                                        <li><a title="{$fans.nickname}" href="{:U('Original/original_detail2')}?tid={$fans.id}"><img src="{$fans.avatar}"></a></li>
                                            </volist> 
                                </ul>
                    </div>          
                    <?php } ?>
                    
                    <div class="rz-div ogd">
                                <i class="icon-co" title="特邀设计师"></i>
                                <i class="icon-v" title="认证设计师"></i>
                                <i class="icon-gr" title="高级设计师"></i>
                                <i class="icon-cc" title="公司设计师"></i>
                    </div>
            </div>
            <div class="o-ordMod">
                        <div class="zp-tit">{$or_details[0]["flf_name"]}</div>
                        <div class="no24-pt30">{$or_details[0]["title"]}</div>
                        <div class="no14-cor999-pt10">发布时间：<?php echo date("Y.m.d",$or_details[0]["createtime"]); ?></div>
                        <div class="tag_mod clearfix org_m40">
                            <volist name="or_details[0]['tname']" id="obj">
                                <i><a href="{:U('Original/original_tags')}?value={$obj.tname}">{$obj.tname}</a></i>&nbsp;
                            </volist>
                        </div>
            </div>
    </div>
</div>
<!--中部内容end-->
<!-- 左边菜单部分 -->
<include file="layout/left_menu" />
<!--收藏-->
<div class="pop_box change_collection orgin_collection">
        <div class="pop_box_mod">
                    <div class="pop_head">
                                <a class="close_pop" href="javascript:void(0);"></a>
                    </div>
                    <div class="mgh350">
                                <input class="w258 create_input" type="text" placeholder="创建新收藏夹">
                                <a class="setupBtn" href="javascript:void(0);">创建</a>
                                <div id="cname" class="s-opetion">
                                            <div class="con">
                                                          <volist name="names" id="na">
                                                                <p class="opt" value="{$na.id}">{$na.collection_table_name}</p>
                                                          </volist>
                                            </div>
                                            <div class="con2" value=""></div>  
                                            <div class="selDown"></div>  
                                </div>
                                <a class="pop_okBtn confirm_change" style="position:absolute; left:105px;top:155px" href="javascript:void(0);">确认</a>
                    </div>
        </div>
</div>
<!-- 登录注册部分 -->
<include file="layout/login" />
<!-- 尾部js部分 -->
<include file="layout/footer_js" />
<style>
    .js_tow_get_more{
        width: 100%;
        height: 20px;
        background: url("__PUBLIC__/Home/images/icon_down.png") center no-repeat #eee;
    }

    .js_tow_get_more_over{
        width: 100%;
        height: 20px;
        background: url("__PUBLIC__/Home/images/icon_up.png") center no-repeat #eee;
    }
</style>
<script src="http://static.geetest.com/static/tools/gt.js"></script>
<script type="text/javascript" charset="utf-8" src="http://static.bshare.cn/b/buttonLite.js#style=-2&amp;uuid=&amp;pophcol=3&amp;lang=zh"></script>
<script type="text/javascript" charset="utf-8" src="http://static.bshare.cn/b/bshareC0.js"></script>
<script type="text/javascript">
var is_login = {$is_login};

$(document).ready(function() {
          $.ajax({
            url: "{:U('Public/VerCode?type=pc&t=" + (new Date()).getTime() + "')}", // 加随机数防止缓存
            type: "get",
            dataType: "json",
            success: function (data) {
                // 使用initGeetest接口
                // 参数1：配置参数
                // 参数2：回调，回调的第一个参数验证码对象，之后可以使用它做appendTo之类的事件
                initGeetest({
                    gt: data.gt,
                    challenge: data.challenge,
                    product: "float",
                    offline: !data.success
                    }, handlerEmbed);
                }
            });
            var handlerEmbed = function (captchaObj) {
                 // 将验证码加到id为captcha的元素里
                 captchaObj.appendTo("div#embed-captcha");
                 captchaObj.onReady(function () {
                    $("#embed-wait").hide();
                 });
             };
    });
    coSense.loader.init(false);
    coSense.loader.originalJS();
     coSense.loader.toFooter();
    proing();
    $(function(){
        var islock = false;
        var plock = false;
        //收藏
        $("a#js_collectionBtn").on('click', function(event) {
            if(is_login == 0) {
                $.Prompt('请先登录');
                return false;
            }
            
            event.preventDefault();
            var type = $(this).attr("type");
            var hasOpt = $("div.con .opt").length;
            if(type == 0){
                    $("div.orgin_collection").show();
                    if(hasOpt > 0){
                            $("div#cname").show();
                            $(".con2").text($("div.con .opt").eq(0).text());
                            $('.con2').attr("value",$("div.con .opt").eq(0).attr("value"));
                            $(".opt").on("click",function(){
                                // $("#con p").removeClass('checked');
                                // $(this).addClass('checked');
                                $('.con2').attr("value",$(this).attr("value"));
                                $(".con").hide();
                                $(".con2").show();
                                $(".con2").text($(this).text());
                                $("a.confirm_change").show();
                        })
                        if(hasOpt > 1){
                                    $(".selDown").show();
                        }else{
                                    $(".selDown").hide();
                        }
                        if($(".con").height() > 160){
                                $("#cname").css("overflow-y","scroll");
                                $("#cname").css("overflow-x","hidden")
                         }
                    }else{
                           $("div#cname").hide();
                    }
            }else{
                $.post("{:U('Original/del_collectioned')}",{id:<?php echo I('param.oid','',false); ?>},function(r){
                    $.Prompt(r.msg);
                    $("a#js_collectionBtn").attr('type',0);
                    $("a#js_collectionBtn").text('COLLECTION');
                },'json')
            }

        });
        $("a.close_pop").on('click', function() {
            $("div.orgin_collection").hide();
        });
        $("a.setupBtn").on('click', function() {
                var new_collection =$("input.create_input").val();
                $(".opt").removeClass('checked');
                if(new_collection == ""){
                    $.Prompt("收藏夹名称不能为空");
                    return;
                }
                $.post("{:U('Choiceness/choose_collection')}",{collection_table_name:new_collection},function(r){
                        $.Prompt(r.msg);
                        $("input.create_input").val("");
                        var val = r.data[0]['id'];
                        //得到了最新添加的收藏夹id
                        var name = r.data[0]['collection_table_name'];
                        //得到了最新添加的收藏夹名称                     
                        var html = '<p class="opt checked" value="'+val+'">'+name+'</p>';
                        $(".con").append(html);
                        $(".con2").text(name);
                        $('.con2').attr("value",val);
                        $("#cname").show();
                        $(".con").hide();
                        $(".con2").show();
                        $(".opt").on("click",function(){                            
                                $('.con2').attr($(this).attr("value"));
                                $("a.confirm_change").show();
                                $(".con").hide();
                                $(".con2").show();
                        })
                        if($(".con").height()  > 32){
                                $(".selDown").show();
                        }else{
                                $(".selDown").hide();
                        }
                        if($(".con").height() > 160){
                                $("#cname").css("overflow-y","scroll");
                                $("#cname").css("overflow-x","hidden")
                         }
                },'json')
        });
        $("#con p").on("click",function(event){
            var event = event || window.event;
            event.stopPropagation();
            $('.con2').attr("value",$(this).attr("value"));
            
            $("a.confirm_change").show();
            $(".con").hide();
            $(".con2").show();
        })
        $(".selDown").on("click",function(){
                $(".selDown").hide();
                $(".con2").hide();
                $(".con").show();
                $("a.confirm_change").hide();
        });
        $(".con2").on("click",function(){
                $(".selDown").hide();
                $(".con2").hide();
                $(".con").show();
                $("a.confirm_change").hide();
        });
        $("input.create_input").on('focus',function(){
            $(".con").hide();
            $(".con2").show();
        })
        $("a.confirm_change").on('click', function() {
            var cid = $('.con2').attr('value');

            $.post("{:U('Original/collectioned')}",{cid:cid,id:<?php echo I('param.oid','',false); ?>},function(r){
                if(r.code == -7){
                    $.Prompt(r.msg);
                    $("div.orgin_collection").hide();
                    return;
                }
                $.Prompt(r.msg);
                $("div.orgin_collection").hide();
                $("a#js_collectionBtn")[0].innerHTML = "CANCEL";
                $("a#js_collectionBtn").attr('type',1);
            },'json')
        });

//      点赞js_thumbsBtn
        $("a#js_thumbsIcon").on('click',function(){
            var $num = parseInt($(this).nextAll("div#js_thumbs_num").text()),
            _this = $(this);
            var article_id = $(this).attr("aid"),
            t = $(this).next().attr("pstate"),
            praise_type = 2;
            $(this).addClass("on");
            setTimeout(function(){
                _this.removeClass('on');
            }, 1000);
            if(t == 0){
                $.post('{:U("/Public/praise_production")}', {article_id: article_id,type:t,praise_type:praise_type}, function(data) {
                    var data = eval("("+data+")");
                    if(data.code == -7){
                        $.Prompt(data.msg);
                        return;
                    }
                    $num += 1;
                    $("a#js_thumbsIcon").next().find("span").text("已赞");
                    $("a#js_thumbsIcon").next().attr("pstate",1);
                    _this.nextAll("div#js_thumbs_num").text($num);
                });
            }else{
                $.post('{:U("/Public/praise_production")}', {article_id: article_id,type:t,praise_type:praise_type}, function(data) {
                    var data = eval("("+data+")");
                    if(data.code == -7){
                        $.Prompt(data.msg);
                        return;
                    }
                    $num -= 1;
                    $("a#js_thumbsIcon").next().find("span").text("可赞");
                    $("a#js_thumbsIcon").next().attr("pstate",0);
                    _this.nextAll("div#js_thumbs_num").text($num);
                });
            }
            
            
        });
        $.get("{:U('Comment/com_lst')}",{id:<?php echo I('param.oid','',false); ?>,type:2},function(str){
            $('#comment_cnt').html(str);
        });
        //关注
        $("a.followBtn").on('click', function(event) {
            event.preventDefault();
            var t = 0,
            _this = $(this),
            pid = _this.attr("ids");
            var type = _this.attr("type");
            if(type == 0){
                $.post('{:U("/Public/fans_follow")}', {id:pid,type:type}, function(data) {
                    var data = JSON.parse(data);
                    if(data.code == -7){
                        $.Prompt(data.msg);
                        return;
                    }
                    if(data.code == -54){
                        $.Prompt(data.msg);
                        return;
                    }
                    _this.attr("type",1);
                    $("a.followBtn").text("CANCEL");
                    var num = parseInt(_this.next().next().text())+1;
                    _this.next().next().text(num);
                });
            }else{
                $.post('{:U("/Public/fans_follow")}', {id:pid,type:type}, function(data) {
                    var data = JSON.parse(data);
                    if(data.code == -7){
                        $.Prompt(data.msg);
                        return;
                    }
                    if(data.code == -54){
                        $.Prompt(data.msg);
                        return;
                    }
                    _this.attr("type",0);
                    $("a.followBtn").text("FOLLOW");
                    var num = parseInt(_this.next().next().text())-1;
                    _this.next().next().text(num);
                });
            }

        });
    });
</script>

<script type="text/javascript">
    $(function(){
        var id = "{:I('oid', 1)}";
        var type = "{:I('type', 2)}";
        //展开二级评论框
        $(document).on('click',".js_commentBtn",function(){
            var $this = $(this);
            var uid = $this.attr('myuid');
            var pid = $this.attr('pid');
            var zxpid = $this.attr('zxpid');

            $this.toggleClass('add');
            var $sendHtml = '<div class="comSendMod">' +
                    '<textarea class="textarea_info" readonly="false"></textarea> ' +
                    '<div class="mgt30-tr"> <a class="plh_Btn js_sendBtn curr" touid="'+uid+'" pid="'+pid+'" zxpid="'+zxpid+'" href="javascript:void(0);">SEND</a></div></div>';
            if($this.hasClass('add')){
                $this.parent().parent().children(".js_comSendMod").html($sendHtml);
            }else{
                $this.parent().parent().children(".js_comSendMod").html('');
            }
        });
            
        $(document).on('keyup','.textarea_info',function(){
            if($(this).val() != '') {
                $(this).siblings('div .mgt30-tr').eq(0).find('a').removeClass('curr')
            }else{
                $(this).siblings('div .mgt30-tr').eq(0).find('a').addClass('curr')
            }
        });

        //发送评论
        $(document).on('click','.js_sendBtn',function(){
            var touid = $(this).attr('touid');
            // var touid = $(".p-name").attr("ids");
            var $val = $(this).parent().prev('textarea').val();
            var pid = $(this).attr('pid');
            var zxpid = $(this).attr('zxpid');
            var cnt_ctrol = $(this).parent().prev('textarea');

            var $temp = $(this).closest('.js_comSendMod').parent().children('.pal-r0').find('.js_commentBtn');
            var thisf = $(this);
            var $zanNum = parseInt($temp.text());
            var $html = '';

            if($val == ''){
                $.Prompt('评论内容不能为空！');
                return false;
            }else{
	            if($(this).hasClass('wdl')){
	                $.Prompt("请先登录!")
	                return;
	            }
                $.post("{:U('Comment/add_comment')}",{aid:id,type:type,to_uid:touid,pid:pid,zx_pid:zxpid,cnt:$val}, function(r){
                    if(r.code == 0) {
                        //一级评论
                        if(pid == 0) {
                            var str =   '<li class="topli"><div class="pal-r0">\
                                            <a class="zan_listBtn js_thumbsBtn" href="javascript:void(0);" ids="'+r.data.id+'">0</a>\
                                            <a class="pingl_listBtn js_commentBtn" myuid="'+r.data.uid+'" pid="'+r.data.id+'" zxpid="'+r.data.id+'" href="javascript:void(0);">0</a>\
                                        </div>\
                                        <div class="info_photo"><img src="'+r.data.avatar+'"></div>\
                                        <div class="info_title">'+r.data.nickname+'</div>\
                                        <div class="info_time">'+r.data.time+'</div>\
                                        <div class="info_txt">'+r.data.cnt+'</div>\
                                        <div class="js_comSendMod">\
                                        </div><ul class="list_ul_tow"></ul></li>';

                            $('.news_d').prepend(str);
                            cnt_ctrol.val('');
                        //次级评论
                        }else{
                            var str = '<li>\
                                <div class="pal-r0">\
                                    <a class="zan_listBtn js_thumbsBtn" href="javascript:void(0);" ids="'+r.data.id+'">0</a>\
                                    <a class="pingl_listBtn js_commentBtn" myuid="'+r.data.uid+'" pid="'+r.data.id+'" zxpid="'+r.data.id+'" href="javascript:void(0);">0</a>\
                                </div>\
                                <div class="info_photo"><img src="'+r.data.avatar+'"></div>\
                                <div class="info_title">'+r.data.nickname+'</div>\
                                <div class="info_time">'+r.data.time+'</div>\
                                <div class="info_txt">@'+r.data.to_nickname+'：'+r.data.cnt+'</div>\
                                <div class="js_comSendMod">\
                                </div>\
                            </li>';

                            thisf.parents('li.topli').find('.list_ul_tow').append(str)
                        }

                        $temp.text($zanNum+1);
                        thisf.closest('.js_comSendMod').html('');
                    }else{
                        $.Prompt(r.msg)
                    }
                },'json')
            }
        });

        //点赞js_thumbsBtn
        $(document).on('click','.js_thumbsBtn',function(){
            if(is_login == 0) {
                $.Prompt('请先登录');
                return false;
            }

            var id = $(this).attr('ids');
            var thisf = $(this);

            $.get("{:U('Comment/com_praise')}", {id:id}, function(r){
                if(r.code == 1) {
                    var $num = parseInt(thisf.text());
                    $num += 1;
                    thisf.text($num);
					
                	thisf.css("background","url('/Public/Home/images/zan2_icon.png') no-repeat");
                	thisf.attr("data-index","1");
                }else{
                    var $num = parseInt(thisf.text());
                    $num -= 1;
                    thisf.text($num);
					
                	thisf.css("background","url('/Public/Home/images/zan_icon.png') no-repeat");
                	thisf.attr("data-index","0");
                }
            },'json')
        });

        //加载更多一级评论及其下的多级评论
        $(document).on('click','.js_get_more',function(){
            var thisf = $(this);
            var nowpage = (parseInt(thisf.attr('nowpage'))+1);
            var is_more = (parseInt(thisf.attr('ismore')));
            if(is_more == 0) return false; 

            $.get("{:U('Comment/com_lst')}", {id:id, type:type, page:nowpage, return_type:2}, function(r){
                if(r.code == 0) {
                    //1、当前page + 1
                    thisf.attr('nowpage', nowpage);

                    //2、分配获取到的数据
                    if(parseInt(r.data.length) != 0) {
                        var str = "";
                        $.each(r.data,function(n,v) {
                            str += '<li><div class="pal-r0"><a class="zan_listBtn js_thumbsBtn" href="javascript:void(0);" ids="'+v.id+'">'+v.praise_nums+'</a><a class="pingl_listBtn js_commentBtn" myuid="'+v.uid+'" pid="'+v.id+'" zxpid="'+v.id+'" href="javascript:void(0);">'+v.com_nums+'</a></div><div class="info_photo"><img src="'+v.avatar+'"></div><div class="info_title">'+v.nickname+'</div><div class="info_time">'+v.time+'</div><div class="info_txt">'+v.cnt+'</div><div class="js_comSendMod"></div>';
                                
                            if(parseInt(v.son_lst.length) != 0) {
                                str += '<ul class="list_ul_tow">';
                                $.each(v.son_lst,function(nn,vv) {
                                    str += '<li><div class="pal-r0"><a class="zan_listBtn js_thumbsBtn" href="javascript:void(0);" ids="'+vv.id+'">'+vv.praise_nums+'</a><a class="pingl_listBtn js_commentBtn" myuid="'+v.uid+'" pid="'+vv.id+'" zxpid="'+v.id+'" href="javascript:void(0);" >'+vv.com_nums+'</a></div><div class="info_photo"><img src="'+vv.avatar+'"></div><div class="info_title">'+vv.nickname+'</div><div class="info_time">'+vv.time+'</div><div class="info_txt">@'+vv.to_nickname+':'+vv.cnt+'</div><div class="js_comSendMod"></div></li>';
                                })
                                str += '</ul>';

                                if(parseInt(v.son_lst_count) > 10) str += '<div class="more_pl js_tow_get_more" nowpage="1" ismore="1" fid="'+v.id+'"><a></a></div>';
                            }
                            str += '</li>';
                        });

                        $('.news_d').append(str);
                    }else{
                        thisf.attr('ismore', 0);
                        thisf.css('background', '#c9c9c9');
                        thisf.find('a').html('NO MORE');
                    }
                }else{
                    $.Prompt('系统错误!');
                }
            },'json')
        }); 

        //加载更多的二级评论
        $(document).on('click','.js_tow_get_more',function(){
            var thisf = $(this);
            var id = thisf.attr('fid');
            var nowpage = (parseInt(thisf.attr('nowpage'))+1);
            var is_more = (parseInt(thisf.attr('ismore')));

            $.get("{:U('Comment/son_lst')}", {id:id, page:nowpage}, function(r){
                thisf.attr('nowpage', nowpage);
                if(parseInt(r.data.length) != 0) {
                    var str = '';
                    $.each(r.data,function(n,v) {
                        str += '<li><div class="pal-r0"><a class="zan_listBtn js_thumbsBtn" href="javascript:void(0);" ids="'+v.id+'">'+v.praise_nums+'</a><a class="pingl_listBtn js_commentBtn" myuid="'+v.uid+'" pid="'+v.id+'" zxpid="'+id+'" href="javascript:void(0);" >'+v.com_nums+'</a></div><div class="info_photo"><img src="'+v.avatar+'"></div><div class="info_title">'+v.nickname+'</div><div class="info_time">'+v.time+'</div><div class="info_txt">@'+v.to_nickname+':'+v.cnt+'</div><div class="js_comSendMod"></div></li>';
                    })

                    thisf.prev('.list_ul_tow').eq(0).append(str);
                }else{
                    $('.js_tow_get_more').addClass('js_tow_get_more_over');
                    $('.js_tow_get_more').removeClass('js_tow_get_more');
                }
            },'json')
        });
    })
</script>
</html>